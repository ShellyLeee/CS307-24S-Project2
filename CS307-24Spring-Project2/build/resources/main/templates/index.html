<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>地铁管理系统</title>
    <style>
        body {
            text-align: center; /* 让标题居中 */
        }
        .buttons {
            margin-top: 20px; /* 距离标题的上边距 */
        }
        .buttons button {
            margin: 5px; /* 按钮之间的间距 */
        }
    </style>

    <style>
        /* 样式用于模态框 */
        .modal {
            display: none; /* 初始隐藏 */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* 半透明背景 */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>地铁管理系统</h1>




<div class="buttons">
    <button id="loginButton">查看card</button>
    <button id="deleteButton">删除站点</button>
    <button id="insertButton">增加站点</button>
    <!-- 按钮触发对话框 -->
    <button onclick="openDialog()">查询站点</button>
    <button onclick="openUpdateDialog()">修改站点</button>
    <button id="boardExitButton">出站/进站</button>
    <button id="viewPassengerButton">查询进站乘客</button>
    <button id="viewCardButton">查询进站公交卡</button>
</div>

<!-- 查询Card按钮 -->
<script>
    document.getElementById("loginButton").addEventListener("click", function() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "http://localhost:8080/card/selectAll", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                window.location.href = "http://localhost:8080/card/selectAll";
                var response = JSON.parse(xhr.responseText);
                // 处理从后端返回的数据
                console.log(response);
            }
        };
        xhr.send();
    });
</script>

<!-- 输入查询站点ID的对话框 -->
<div id="inputSelectDialog" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeSelectDialog()">&times;</span>
        <p>请输入想要查询的站点ID：</p>
        <input type="number" id="stationIdSelect">
        <br><br>
        <button onclick="submitContentSelect()">提交</button>
    </div>
</div>

<!-- 查询站点按钮逻辑 -->
<script>
    var modal = document.getElementById("inputSelectDialog");

    function openDialog() {
        modal.style.display = "block";
    }
    function closeSelectDialog() {
        modal.style.display = "none";
    }
    function submitContentSelect() {
        var stationId = document.getElementById("stationIdSelect").value;
        if (stationId >= 1 && stationId <= 306) {
            // 构造目标跳转链接
            var targetURL = "http://localhost:8080/station/selectById?id=" + stationId;
            // 执行页面跳转
            window.location.href = targetURL;
        } else {
            alert("请输入1到306之间的数字！");
        }
// 关闭对话框
        closeSelectDialog();
    }

</script>


<!-- 输入增加站点ID的对话框 -->
<div id="inputInsertDialog" style="display: none;">
    <p>请输入想要增加的站点信息：</p>
    <label for="district">地区:</label>
    <input type="String" id="district">
    <label for="englishName">英文名:</label>
    <input type="String" id="englishName">
    <label for="chineseName">中文名:</label>
    <input type="String" id="chineseName">
    <label for="intro">介绍:</label>
    <input type="String" id="intro">
    <br><br>
    <button id="insertConfirmButton">确认</button>
</div>

<!-- 输入删除站点ID的对话框 -->
<div id="inputDeleteDialog" style="display: none;">
    <p>请输入想要删除的站点ID：</p>
    <input type="number" id="stationIdDelete">
    <br><br>
    <button id="deleteConfirmButton">确认</button>
</div>


<!-- 修改站点信息的对话框 -->
<div id="updateDialog" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeUpdateDialog()">&times;</span>
        <p>请输入想修改的站点中文名：</p>
        <input type="text" id="chineseNameInput">
        <br><br>
        <button onclick="confirmUpdate()">确认</button>
    </div>
</div>

<!-- 显示站点信息的对话框 -->
<div id="stationInfoDialog" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeStationInfoDialog()">&times;</span>
        <p id="stationInfo"></p>
        <!-- 这里添加四个框，用来输入需要修改的内容 -->

        <input type="text" id="districtInput" placeholder="地区">
        <input type="text" id="englishNameInput" placeholder="英文名">
        <input type="text" id="chineseNameInput1" placeholder="中文名">
        <input type="text" id="introInput" placeholder="简介">
        <br><br>
        <button onclick="submitUpdate()">提交</button>
    </div>
</div>

<script>
    function openUpdateDialog() {
        var dialog = document.getElementById("updateDialog");
        dialog.style.display = "block";
    }

    function closeUpdateDialog() {
        var dialog = document.getElementById("updateDialog");
        dialog.style.display = "none";
    }

    function closeStationInfoDialog() {
        var dialog = document.getElementById("stationInfoDialog");
        dialog.style.display = "none";
    }

    function confirmUpdate() {
        var chineseName = document.getElementById("chineseNameInput").value;
        // 调用后端接口获取站点信息
        fetch(`http://localhost:8080/station/selectByChineseName?chineseName=${chineseName}`)
            .then(response => response.json())
            .then(data => {
                // 显示站点信息的对话框
                var dialog = document.getElementById("stationInfoDialog");
                dialog.style.display = "block";
                // 更新站点信息对话框中的内容
                document.getElementById("districtInput").value = data.district;
                document.getElementById("englishNameInput").value = data.englishName;
                document.getElementById("chineseNameInput1").value = data.chineseName;
                document.getElementById("introInput").value = data.intro;
            })
            .catch(error => console.error('Error:', error));
        closeUpdateDialog();
    }

    function submitUpdate() {
        var district = document.getElementById("districtInput").value;
        var englishName = document.getElementById("englishNameInput").value;
        var chineseName = document.getElementById("chineseNameInput1").value;
        var intro = document.getElementById("introInput").value;
        var data = {
            district: district,
            englishName: englishName,
            chineseName: chineseName,
            intro: intro
        };
        fetch('http://localhost:8080/station/updateStation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('站点修改失败！');
            })
            .then(message => {
                alert("站点修改成功！" + message);
            })
            .catch(error => {
                alert("站点修改失败：" + error.message);
            });
        closeStationInfoDialog();
    }
</script>




<!-- 输入上车/下车乘客信息的对话框-->
<div id="inputPassengerDialog" style="display: none;">
    <p>请输入乘客信息（ID与卡号选填一个）：</p>
    <label for="PassengerID">ID:</label>
    <input type="String" id="PassengerID">
    <label for="CardCode">卡号:</label>
    <input type="String" id="CardCode">
    <label for="start_station">始发站:</label>
    <input type="String" id="start_station">
    <label for="exit_station">终到站:</label>
    <input type="String" id="exit_station">
    <br><br>
    <button id="boardConfirmButton">进站</button>
    <button id="exitConfirmButton">出站</button>
</div>


<!-- 增加站点按钮逻辑 -->
<script>
    document.getElementById("insertButton").addEventListener("click", function() {
        var dialog = document.getElementById("inputInsertDialog");
        if (dialog.style.display === "none" || dialog.style.display === "") {
            dialog.style.display = "block";
        } else {
            dialog.style.display = "none";
        }
    });

    // 当点击确认按钮时读取输入数据，并发送到服务器
    document.getElementById("insertConfirmButton").addEventListener("click", function() {
        var district = document.getElementById("district").value;
        var englishName = document.getElementById("englishName").value;
        var chineseName = document.getElementById("chineseName").value;
        var intro = document.getElementById("intro").value;

        var data = {
            district: district,
            englishName: englishName,
            chineseName: chineseName,
            intro: intro
        };

        fetch('http://localhost:8080/station/insert', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('站点添加失败！');
            })
            .then(message => {
                alert("站点添加成功！" + message);
                // 成功后可以选择隐藏对话框和清除输入框的值
                document.getElementById("inputInsertDialog").style.display = "none";
                document.getElementById("district").value = '';
                document.getElementById("englishName").value = '';
                document.getElementById("chineseName").value = '';
                document.getElementById("intro").value = '';
            })
            .catch(error => {
                alert("站点添加失败：" + error.message);
            });
    });
</script>

<!-- 删除站点按钮逻辑 -->
<script>
    document.getElementById("deleteButton").addEventListener("click", function() {
// 弹出输入框
        var dialog = document.getElementById("inputDeleteDialog");
        if (dialog.style.display === "none" || dialog.style.display === "") {
            dialog.style.display = "block";
        } else {
            dialog.style.display = "none";
        }
    });

    document.getElementById("deleteConfirmButton").addEventListener("click", function() {
        var stationId = document.getElementById("stationIdDelete").value;
        if (stationId >= 1 && stationId <= 306) {
            fetch('http://localhost:8080/station/delete?id=' + stationId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('站点删除失败！');
                })
                .then(message => {
                    alert("站点删除成功！" + message);
                    // 成功后可以选择隐藏对话框和清除输入框的值
                    document.getElementById("inputDeleteDialog").style.display = "none";
                    document.getElementById("stationIdDelete").value = '';
                })
                .catch(error => {
                    alert("站点删除失败：" + error.message);
                });
        } else {
            alert("请输入1到306之间的数字！");
        }
    });
</script>

<!-- 乘客上下车按钮逻辑 -->
<script>
    document.getElementById("boardExitButton").addEventListener("click", function() {
// 弹出输入框
        var dialog = document.getElementById("inputPassengerDialog");
        if (dialog.style.display === "none" || dialog.style.display === "") {
            dialog.style.display = "block";
        } else {
            dialog.style.display = "none";
        }
    });

    document.getElementById("boardConfirmButton").addEventListener("click", function () {
        var ID = document.getElementById("PassengerID").value;
        var code = document.getElementById("CardCode").value;
        var startStation = document.getElementById("start_station").value;
        var time = new Date();
        if (ID != null) {
            var data = {
                passenger_id: ID,
                start_station: startStation,
                start_time: time,
            };
            fetch('http://localhost:8080/passengerOnboard/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('乘客进站失败！');
                })
                .then(message => {
                    alert("乘客进站成功！" + message);
                    // 成功后可以选择隐藏对话框和清除输入框的值
                    document.getElementById("inputPassengerDialog").style.display = "none";
                    document.getElementById("PassengerID").value = '';
                    document.getElementById("englishName").value = '';
                    document.getElementById("start_station").value = '';
                })
                .catch(error => {
                    alert("乘客进站失败：" + error.message);
                });
        } else if (code != null){
            var data = {
                card_code: code,
                start_station: startStation,
                start_time: time,
            };
            fetch('http://localhost:8080/cardOnboard/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('乘客进站失败！');
                })
                .then(message => {
                    alert("乘客进站成功！" + message);
                    // 成功后可以选择隐藏对话框和清除输入框的值
                    document.getElementById("inputPassengerDialog").style.display = "none";
                    document.getElementById("PassengerID").value = '';
                    document.getElementById("englishName").value = '';
                    document.getElementById("start_station").value = '';
                })
                .catch(error => {
                    alert("乘客进站失败：" + error.message);
                });
        }
    })

    document.getElementById("exitConfirmButton").addEventListener("click", function ()  {
        var ID = document.getElementById("PassengerID").value;
        var code = document.getElementById("CardCode").value;
        var startStation = document.getElementById("start_station").value;
        var endStation = document.getElementById("exit_station").value;
        var time = new Date();
        if (ID != null) {
            var data = {
                passenger_id: ID,
                start_station: startStation,
                end_station: endStation,
                end_time: time,
            };
            //添加ride
            fetch('http://localhost:8080/passengerRide/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('行程记录失败！');
                })
                .then(message => {
                    alert("行程记录成功！" + message);
                })
                .catch(error => {
                    alert("行程记录失败：" + error.message);
                });
            //删除onboard
            fetch('http://localhost:8080/passengerOnboard/deleteByIdStation?' +
                'passenger_id=' + ID + '&start_station=' + startStation,
                {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('乘客出站失败！');
            })
                .then(message => {
                    alert("乘客出站成功！" + message);
                    // 成功后可以选择隐藏对话框和清除输入框的值
                    document.getElementById("inputPassengerDialog").style.display = "none";
                    document.getElementById("PassengerID").value = '';
                    document.getElementById("englishName").value = '';
                    document.getElementById("start_station").value = '';
                    document.getElementById("exit_station").value = '';
                })
                .catch(error => {
                    alert("乘客出站失败：" + error.message);
                });
        } else if (code != null){
            var data = {
                card_code: code,
                start_station: startStation,
                end_station: endStation,
                end_time: time,
            };
            fetch('http://localhost:8080/cardRide/insert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('行程记录失败！');
                })
                .then(message => {
                    alert("行程记录成功！" + message);
                })
                .catch(error => {
                    alert("行程记录失败：" + error.message);
                });
            fetch('http://localhost:8080/cardOnboard/deleteByCodeStation?' + 'card_code' + code + '&start_station=' + startStation,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                }).then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('乘客出站失败！');
            })
                .then(message => {
                    alert("乘客出站成功！" + message);
                    // 成功后可以选择隐藏对话框和清除输入框的值
                    document.getElementById("inputPassengerDialog").style.display = "none";
                    document.getElementById("CardCode").value = '';
                    document.getElementById("englishName").value = '';
                    document.getElementById("start_station").value = '';
                    document.getElementById("exit_station").value = '';
                })
                .catch(error => {
                    alert("乘客出站失败：" + error.message);
                });
        }
    })
</script>
<!-- 查询上车乘客按钮 -->
<script>
    document.getElementById("viewPassengerButton").addEventListener("click", function() {
        // 构造目标跳转链接
        var targetURL = "http://localhost:8080/passengerOnboard/selectAllPassengerOnboard";
        // 执行页面跳转
        window.location.href = targetURL;
    });
</script>
<!-- 查询上车公交卡按钮-->
<script>
    document.getElementById("viewCardButton").addEventListener("click", function() {
        // 构造目标跳转链接
        var targetURL = "http://localhost:8080/cardOnboard/selectAllCardOnboard";
        // 执行页面跳转
        window.location.href = targetURL;
    });
</script>

</body>
</html>

